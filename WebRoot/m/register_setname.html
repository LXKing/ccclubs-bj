<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>车纷享 - 身份认证信息</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="description" content="">

		<link rel="stylesheet" href="${basePath}weixin/css/bootstrap.css">
		<link rel="stylesheet" href="${basePath}weixin/css/main.css">
		<script type="text/javascript" src="${basePath}weixin/js/baidu.js"></script>
		
		<style type="text/css">
		.black_overlay{
             display: none;
             background:#000; display:none; position:absolute; height:100%; width:100%; top:0; left:0;position: fixed;_position: absolute;filter:alpha(opacity=70);-moz-opacity:0.7;-khtml-opacity: 0.7;opacity: 0.7;
        }
        .white_content {
        	display: none;
            position: fixed;
            _position: absolute;
            top: 25%;
            left: 10%;
            width: 80%;
            height: 211px;
            background: url('${basePath}weixin/images/slides/88coin_alert.png') no-repeat;
            background-size:100% 100%;
            z-index:1002;
            overflow: auto;
        }
		</style>
	</head>
	<body>
		<div class="bigmain">
			<div class="buytitle">
				<div class="content">
					<div class="goback">
						<a href="account.html">返回</a>
					</div>
					<div class="showtitle">
						身份认证信息
					</div>
				</div>
			</div>
			<div class="ordersbox">
				<div class="loginbox">
					<div class="loginname">
						<input placeholder="真实姓名" id="txtName" maxlength="8" value="${csMemberInfo.csmiName}" class="setpwd" type="text">
					</div>
					<div class="loginpw">
						<input placeholder="收件地址" id="txtAddress" value="${csMemberInfo.csmiAddress}" class="setpwd" type="text">
					</div>
					<div class="loginpw">
						<input placeholder="驾驶证号" id="txtLicnum" maxlength="18" value="${csMemberInfo.csmiDriverNum}" class="setpwd" type="text">
					</div>
				</div>

				<div class="upbox">
					<s:if test="#request.isPerfect">
						<div class="upsfz">
							<img src="${csMemberInfo.csmiCertifyImage}" />
						</div>
					</s:if>
					<s:elseif test="#request.csMemberInfo.csmiCertifyImage!=null">
						<!--<img src="${csMemberInfo.csmiCertifyImage}">  -->
						<div class="upsfz">
							<img src="${csMemberInfo.csmiCertifyImage}" />
							<div class="processbar" style="position: absolute; display: none; left: 0; top: 0; text-align: center; width: 100%; height: 100%; opacity: 0.8; background: #FFFFFF;">
								<div style="margin: 20% auto 0; color: #0077FF; font-size: 14px; font-weight: bold; text-align: center;">
									<img src="${basePath}images/icons/022.gif" style="width: 32px; height: 32px;" />
									</br>
									上传中图片中，请稍候。。。
								</div>
							</div>
							<input id="fileSfz" type="file" name="file">
						</div>

					</s:elseif>
					<s:else>
						<div class="upsfz">
							<img src="${basePath}weixin/images/upsfz.jpg" />
							<div class="processbar" style="position: absolute; display: none; left: 0; top: 0; text-align: center; width: 100%; height: 100%; opacity: 0.8; background: #FFFFFF;">
								<div style="margin: 20% auto 0; color: #0077FF; font-size: 14px; font-weight: bold; text-align: center;">
									<img src="${basePath}images/icons/022.gif" style="width: 32px; height: 32px;" />
									</br>
									上传中图片中，请稍候。。。
								</div>
							</div>
							<input id="fileSfz" type="file" name="file">
						</div>
						<!--<img class="fileSfzImg" src="images/upsfz.jpg">-->
					</s:else>

					<s:if test="#request.isPerfect">
						<div class="upxsz">
							<img src="${csMemberInfo.csmiDriverImage}" />
						</div>
					</s:if>
					<s:elseif test="#request.csMemberInfo.csmiDriverImage!=null">
						<!--<img src="${csMemberInfo.csmiDriverImage}">  -->
						<div class="upxsz">
							<img src="${csMemberInfo.csmiDriverImage}" />
							<div class="processbar" style="position: absolute; display: none; left: 0; top: 0; text-align: center; width: 100%; height: 100%; opacity: 0.8; background: #FFFFFF;">
								<div style="margin: 20% auto 0; color: #0077FF; font-size: 14px; font-weight: bold; text-align: center;">
									<img src="${basePath}images/icons/022.gif" style="width: 32px; height: 32px;" />
									</br>
									上传中图片中，请稍候。。。
								</div>
							</div>
							<input id="fileJsz" type="file" name="file">
						</div>
					</s:elseif>
					<s:else>
						<!--<img class="fileJszImg" src="images/upxsz.jpg">-->
						<div class="upxsz">
							<img src="${basePath}weixin/images/upxsz.jpg" />
							<div class="processbar" style="position: absolute; display: none; left: 0; top: 0; text-align: center; width: 100%; height: 100%; opacity: 0.8; background: #FFFFFF;">
								<div style="margin: 20% auto 0; color: #0077FF; font-size: 14px; font-weight: bold; text-align: center;">
									<img src="${basePath}images/icons/022.gif" style="width: 32px; height: 32px;" />
									</br>
									上传中图片中，请稍候。。。
								</div>
							</div>
							<input id="fileJsz" type="file" name="file">
						</div>

					</s:else>
				</div>
				<div class="error" style="display: none; margin-top: 10px;" id="errortip">
					<span>姓名格式错误，请输入您的真实姓名</span>
				</div>
				<s:if test="!#request.isPerfect">
					<div class="error" style="margin-top: 10px;">
						<b>您提交的身份认证信息一经审核则无法修改，请提交 正确认证信息</b>
					</div>
					<div class="okbuybtn">
						<s:if test="#request.csMember.csmHost==1">
							<a href="javascript:;" onclick="openWindow()">提交</a>
						</s:if>
						<s:else>
							<a href="javascript:;" onclick="submitInfo()">提交</a>
						</s:else>
					</div>
					<div class="okjumpbtn">
						<a href="account.html">跳过</a>
					</div>
				</s:if>
				<s:else>
					<div class="error" style="margin-top: 10px;">
						<b>您提交的身份认证信息已经通过审核。</b>
					</div>
				</s:else>
			</div>
		</div>
		
		<div id="light" class="white_content">
		<div align="center" style="height: 80%;"></div>
			<div align="center" style="height: 20%;">
				<a hrfe="#" onclick="submitInfo()"><img src="${basePath}weixin/images/slides/88coin_alert_sub.png" style="width: 80%;"></a>
			</div>
		</div>
		<div id="fade" class="black_overlay"></div>
		
		<input type="hidden" value="${csMemberInfo.csmiCertifyImage}" id="sfz">
		<input type="hidden" value="${csMemberInfo.csmiDriverImage}" id="jsz">
		<script src="../js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="../js/jquery.form.js"></script>
		<script src="../js/ccclubs.check.idcard.js" type="text/javascript"></script>
		<script type="text/javascript">
			$(function () {
				$("#fileSfz").wrap("<form id='myuploadSfz' action='${basePath}weixin/upload.html?app=memberinfo_edit' method='post' enctype='multipart/form-data'></form>");
			    $("#fileSfz").change(function(){
					$("#myuploadSfz").ajaxSubmit({
						dataType:  'json',
						beforeSend: function() {
			        		$('.upsfz .processbar').css("display", "block");
			    		},
						success: function(data) {
							$('.upsfz .processbar').css("display", "none");
							$('.upsfz img').attr("src",data.url);
							$('#sfz').val(data.url);
						}
					});
				});
				
				$("#fileJsz").wrap("<form id='myuploadJsz' action='${basePath}weixin/upload.html?app=memberinfo_edit' method='post' enctype='multipart/form-data'></form>");
			    $("#fileJsz").change(function(){
					$("#myuploadJsz").ajaxSubmit({
						dataType:  'json',
						beforeSend: function() {
			        		$('.upxsz .processbar').css("display", "block");
			    		},
						success: function(data) {
							$('.upxsz .processbar').css("display", "none");
							$('.upxsz img').attr("src",data.url);
							$('#jsz').val(data.url);
						}
					});
				});
			});
			
			function openWindow(){
				if($.trim($("#txtName").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("真实姓名需要填写。");
					return;
				}
				var address = $.trim($("#txtAddress").val());
				if(address.length<=0){
					$('#errortip').css("display", "block");
					$('#errortip').html("收货地址需要填写。");
					return;
				}
				var v = $.trim($("#txtLicnum").val());
				if($.trim($("#sfz").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("需要上传身份证照片。");
					return;
				}
				if($.trim($("#jsz").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("需要上传驾驶证照片。");
					return;
				}
	            document.getElementById('light').style.display='block';
	            document.getElementById('fade').style.display='block';
	        }
	        function closeWindow(){
	            document.getElementById('light').style.display='none';
	            document.getElementById('fade').style.display='none';
	        }
		
			function submitInfo(){
				if($.trim($("#txtName").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("真实姓名需要填写。");
					return;
				}//^(1[3|4|5|8][0-9])\\d{8}$
				var address = $.trim($("#txtAddress").val());
				if(address.length<=0){
					$('#errortip').css("display", "block");
					$('#errortip').html("收货地址需要填写。");
					return;
				}
				var v = $.trim($("#txtLicnum").val());
             	//if(!isChinaIDCard(v))
			    //  {
				//	  $('#errortip').css("display", "block");
				//	  $('#errortip').html("请正确填写驾驶证号。");
				//	  return;
				//  }
				if($.trim($("#sfz").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("需要上传身份证照片。");
					return;
				}
				if($.trim($("#jsz").val()).length<=0)
				{
					$('#errortip').css("display", "block");
					$('#errortip').html("需要上传驾驶证照片。");
					return;
				}
				$.ajax({
						url: 'register_saveDriver2.html',
						type: "POST",
						data: {
							txtName: $.trim($("#txtName").val()),
							txtLicnum: $.trim($("#txtLicnum").val()),
							txtaddress: $.trim($("#txtAddress").val()),
							txtLicPic:$.trim($("#jsz").val()),
							txtVerPic:$.trim($("#sfz").val())
						},
						async: false,
						success: function(data) {
							switch (data) {
								case "100":
									location.href = 'home/index.html';
									break;
								case "101":
									location.href = 'register.html';
									break;
								case "102":
									var msg = "真实姓名需要填写。";
									$('#errortip').css("display", "block");
									$('#errortip').html(msg);
									break;
								case "103":
									var msg = "驾驶证号需要填写。";
									$('#errortip').css("display", "block");
									$('#errortip').html(msg);
									break;
								case "104":
									var msg = "驾驶证照片需要上传。";
									$('#errortip').css("display", "block");
									$('#errortip').html(msg);
									break;
								case "105":
									var msg = "身份证照片需要上传。";
									$('#errortip').css("display", "block");
									$('#errortip').html(msg);
									break;
								case "9999":
									alert("系统错误,请稍候再试");
									break;
								default:
									alert("未知的返回"); 
									return;
							}
					 }
				});
			}
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			WeixinJSBridge.call('hideToolbar');
		});
		</script>
	</body>
</html>