<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>车纷享 - 订单续订</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/main.css">
		<script type="text/javascript" src="js/baidu.js"></script>
	</head>
	<body>
		<div class="bigmain">
			<div class="buytitle">
				<div class="content">
					<div class="goback">
						<a href="account_order.html?from=${from}">返回</a>
					</div>
					<div class="showtitle">
						订单续订
					</div>
				</div>
			</div>
			<div class="ordersbox">
				<div class="carlist">
					<dl>
						<dt>
							<img style="height: 100px;" src="/images/cars/${csOrder.csoModel}_wide.jpg">
						</dt>
						<dd style="line-height:20px;">
							<h1>
								<b>${csOrder.$csoModel.cscmName}<u>|</u>${csOrder.$csoCar.cscCarNo}</b>
								<s:if test="#request.csOrder.csoIsAdCar">
									<span>宣</span>
								</s:if>
							</h1>
							<p>
								订单号：${csOrder.csoId}
							</p>
							<p>
								下单时间：${lz:date(csOrder.csoAddTime,"yyyy-MM-dd , HH:mm")}
							</p>
							<p>
								金额:
								<strong>${lz:digit(csOrder.csoPayNeed,2)} </strong>元
							</p>
							<p>
								<img src="images/address.png">
								${csOrder.$csoOutlets.csoName}
							</p>
						</dd>
					</dl>
				</div>
				<div class="cartime" style="margin-top: 15px;">
					<table width="100%" class="timetext" border="0" cellspacing="0" cellpadding="0">
						<tbody>
							<tr>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td class="ttext">
									6:00
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td class="ttext">
									12:00
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td class="ttext">
									18:00
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
								<td>
									&nbsp;
								</td>
							</tr>
						</tbody>
					</table>
					<div class="cartime24">
						<table width="100%" cellspacing="0" cellpadding="0">
							<tbody>
								<tr>
									<td class="first">
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
									<td>
										&nbsp;
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<s:action name="reserve_timeline" executeResult="true" namespace="/weixin">
						<s:param name="car">${csOrder.csoCar}</s:param>
						<s:param name="date">${lz:date(csOrder.csoFinishTime,"yyyy-MM-dd")}</s:param>
					</s:action>
				</div>
				<div class="carkuai">
					<span style="line-height: 30px; height: 30px;">快捷续订</span>
					<div class="ccc-order-sel-item ccc-item-right">
						<div id="qicTime" class="ccc-qic-time-pick">
							<a href="#" class="ccc-qic-time-picker cur" data="1"><b></b><i></i><span>1</span> </a>
							<a href="#" class="ccc-qic-time-picker" data="2"><b></b><i></i><span>2</span> </a>
							<a href="#" class="ccc-qic-time-picker" data="12"><b></b><i></i><span>12</span> </a>
							<a href="#" class="ccc-qic-time-picker" data="24"><b></b><i></i><span>24</span> </a>
							<span class="ccc-qic-time-unit"> 小时</span>
						</div>
					</div>
				</div>

				<div class="carkuai">
					<span>还车时间</span>
					<div style="display: inline-block; float: right; width: 68%; overflow: hidden;">
						<div style="width: 55%; float: left; overflow: hidden;">
							<select class="select" id="txtDateMax_1" style="width: 100%; line-height: 34px; height: 34px; overflow: hidden;">
								<s:iterator value="#request.dates" id="item" status="i">
									<option value="${lz:date(item,"yyyy-MM-dd")}">
										${lz:date(item,"MM月dd日")}
									</option>
								</s:iterator>
							</select>
						</div>
						<div style="width: 45%; float: left; overflow: hidden;">
							<select class="select" id="txtHourMax_1" style="width: 100%; line-height: 34px; height: 34px; overflow: hidden;">
								<option Value="07:00">
									07点整
								</option>
								<option Value="07:20">
									07点20分
								</option>
								<option Value="07:40">
									07点40分
								</option>
								<option Value="08:00">
									08点整
								</option>
								<option Value="08:20">
									08点20分
								</option>
								<option Value="08:40">
									08点40分
								</option>
								<option Value="09:00">
									09点整
								</option>
								<option Value="09:20">
									09点20分
								</option>
								<option Value="09:40">
									09点40分
								</option>
								<option Value="10:00">
									10点整
								</option>
								<option Value="10:20">
									10点20分
								</option>
								<option Value="10:40">
									10点40分
								</option>
								<option Value="11:00">
									11点整
								</option>
								<option Value="11:20">
									11点20分
								</option>
								<option Value="11:40">
									11点40分
								</option>
								<option Value="12:00">
									12点整
								</option>
								<option Value="12:20">
									12点20分
								</option>
								<option Value="12:40">
									12点40分
								</option>
								<option Value="13:00">
									13点整
								</option>
								<option Value="13:20">
									13点20分
								</option>
								<option Value="13:40">
									13点40分
								</option>
								<option Value="14:00">
									14点整
								</option>
								<option Value="14:20">
									14点20分
								</option>
								<option Value="14:40">
									14点40分
								</option>
								<option Value="15:00">
									15点整
								</option>
								<option Value="15:20">
									15点20分
								</option>
								<option Value="15:40">
									15点40分
								</option>
								<option Value="16:00">
									16点整
								</option>
								<option Value="16:20">
									16点20分
								</option>
								<option Value="16:40">
									16点40分
								</option>
								<option Value="17:00">
									17点整
								</option>
								<option Value="17:20">
									17点20分
								</option>
								<option Value="17:40">
									17点40分
								</option>
								<option Value="18:00">
									18点整
								</option>
								<option Value="18:20">
									18点20分
								</option>
								<option Value="18:40">
									18点40分
								</option>
								<option Value="19:00">
									19点整
								</option>
								<option Value="19:20">
									19点20分
								</option>
								<option Value="19:40">
									19点40分
								</option>
								<option Value="20:00">
									20点整
								</option>
								<option Value="20:20">
									20点20分
								</option>
								<option Value="20:40">
									20点40分
								</option>
								<option Value="21:00">
									21点整
								</option>
								<option Value="21:20">
									21点20分
								</option>
								<option Value="21:40">
									21点40分
								</option>
								<option Value="22:00">
									22点整
								</option>
								<option Value="22:20">
									22点20分
								</option>
								<option Value="22:40">
									22点40分
								</option>
								<option Value="23:00">
									23点整
								</option>
								<option Value="23:20">
									23点20分
								</option>
								<option Value="23:40">
									23点40分
								</option>
								<option Value="01:00">
									00点整
								</option>
								<option Value="01:20">
									01点20分
								</option>
								<option Value="01:40">
									01点40分
								</option>
								<option Value="02:00">
									02点整
								</option>
								<option Value="02:20">
									02点20分
								</option>
								<option Value="02:40">
									02点40分
								</option>
								<option Value="03:00">
									03点整
								</option>
								<option Value="03:20">
									03点20分
								</option>
								<option Value="03:40">
									03点40分
								</option>
								<option Value="04:00">
									04点整
								</option>
								<option Value="04:20">
									04点20分
								</option>
								<option Value="04:40">
									04点40分
								</option>
								<option Value="05:00">
									05点整
								</option>
								<option Value="05:20">
									05点20分
								</option>
								<option Value="05:40">
									05点40分
								</option>
								<option Value="06:00">
									06点整
								</option>
								<option Value="06:20">
									06点20分
								</option>
								<option Value="06:40">
									06点40分
								</option>
							</select>
						</div>
						<div style="clear: both;"></div>
					</div>
				</div>
				<div class="okbuybtn">
					<a href="javascript:;" onclick="checkout(${csOrder.csoId});">续订</a>
				</div>
			</div>
			<!-- 弹出层 -->
			<div class="black"></div>
			<div class="popbox">
				<p>
					提示信息：操作提示内容，如改时间段 已被预订请修改时间，续订成功等
				</p>
				<div class="popselect">
					<a href="javascript:;">确定</a>
				</div>
			</div>
			<script src="js/jquery-1.7.1.min.js"></script>
			<script type="text/javascript">
			$(document).ready(function() {
				$("#txtDateMax_1").val("${lz:date(newFinish,'yyyy-MM-dd')}");
				$("#txtHourMax_1").val("${lz:date(newFinish,'HH:mm')}");
			});
			$(document).on('click','#qicTime .ccc-qic-time-picker',function() {
				$(this).addClass('cur').siblings().removeClass('cur');
				var dt1 = new Date(Date.parse('${lz:date(csOrder.csoFinishTime,"yyyy/MM/dd HH:mm")}'));
				var hours= $(this).attr('data');
				dt1.setTime(dt1.getTime()+1000*60*60*hours);
				var strDate=dt1.getFullYear()+(((dt1.getMonth()+1)<10)?"-0":"-")+(dt1.getMonth()+1)+((dt1.getDate()<10)?"-0":"-")+dt1.getDate();
				$("#txtDateMax_1").val(strDate);
				var strHour=((dt1.getHours()<10)?"0":"")+dt1.getHours()+((dt1.getMinutes()<10)?":0":":")+dt1.getMinutes();
				$("#txtHourMax_1").val(strHour);
				return false;
			});
			$(document).on('click','.popselect a',function(){
				$('.black').css("display", "none");
				$('.popbox').css("display", "none");
			});
			
			function open(){
				$('.black').css("display", "block");
				$('.popbox').css("display", "block");
			};
				
			function checkout(order){
				/*if('${csOrder.csoCreditCard}'!=null&&'${csOrder.csoCreditCard}'!=''){
					alert("免押金订单暂不支持续约");
					return;
				}*/
				var finish = $("#txtDateMax_1").val() + " " + $("#txtHourMax_1").val()+':00';
				var ajax = {
					url: "account_renewSubmit.html?t="+new Date().getTime(),
					type: "POST",
					data: {
						newFinishDate: finish,
						order: order,
						from:'${from}'
					},
					async: true,
					beforeSend: function() {
						$('.okbuybtn').css("display", "none");
					},
					success: function(data) {
						$('.okbuybtn').css("display", "block");
						switch (data) {
							case "100":
								location.href =  'account_order.html?from=${from}';
								break;
							case "101":
								location.href = 'login.html?from=${from}';
								break;
							case "102":
								$('.popbox p').html('亲，只有本人才能续订订单哦～');
								open();
								break;
							case "103":
								$('.popbox p').html('免押金续订时长不能超过3小时，请尽快安排行程还车哦～');
								open();
								break;
							case "104":
								$('.popbox p').html('免押金订单只能续订三次，请尽快安排行程还车哦～');
								open();
								break;
							case "false":
								$('.popbox p').html('亲，请选择一个新的还车时间～');
								open();
								break;
							case "9999":
								$('.popbox p').html('系统出问题啦，请联系客服！');
								open();
								break;
							case "444":
								$('.popbox p').html('亲，余额不足！');
								open();
								break;
							default:
								$('.popbox p').html(data);
								open();
								break;
						}
					}
				}
			$.ajax(ajax);
			return false;
		}
		document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
			WeixinJSBridge.call('hideToolbar');
		});
			</script>
	</body>
</html>
