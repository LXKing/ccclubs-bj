<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="author" content="Acathur" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="renderer" content="webkit">
		<title>超值优惠${lz:config('html_title_summary')}</title>
		<meta name="keywords" content="${lz:config('html_header_keyword')}" />
		<meta name="description" content="${lz:config('html_header_description')}" />
		<link rel="stylesheet" href="/css/ccclubs.global.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/ccclubs.discount.model.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/ccclubs.discount.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/ccclubs.discount.confirm.css?v=${lz:config('version')}" type="text/css" />
		<!--[if lt IE 9]>
			<script type="text/javascript" src="js/html5.js"></script>
		<![endif]-->
	</head>

	<body>

		<div id="ccc-fullscreen">
			<div class="ccc-background">
				<img src="/images/backgrounds/tVcfNTa.jpg" />
			</div>
		</div>

		<div id="ccc-global-cont">
			<%@ include file="/include/nav.html"%>

			<div id="ccc-container" class="ccc-grid-980">
				<div class="ccc-discount-intro">
					<button class="ccc-discount-help-1">
						<div>
							19.70*5（租金）+0.55*80（里程费）=142.50
						</div>
					</button>
					<button class="ccc-discount-help-2">
						<div>
							[19.70*5（租金）+0.55*80（里程费）]*0.95(现金券折扣)=135.38
						</div>
					</button>
					<button class="ccc-discount-help-3">
						<div>
							[9.9*5（折合租金）+0.55*80（里程费）]*0.95=88.83
						</div>
					</button>
				</div>

				<div class="ccc-paper ccc-clearfix">
					<div class="ccc-form-header" id="ccc-car-cash">
						<img src="/images/icons/divider-top.png" class="ccc-my-divider divider-top" />
						<h2>
							现金券购买
						</h2>
						<img src="/images/icons/simple-divider.png" class="ccc-my-divider" />
					</div>
					<div class="ccc-discount-wrap ccc-clearfix">
						<!-- 
						<div class="ccc-discount-item coupon">
							<div class="ccc-discount-bg">
								<img src="/images/coupon-bg.png" width="240" height="140" />
							</div>
							<div class="ccc-discount-cont ccc-clearfix">
								<div class="ccc-title">
									现金券
								</div>
								<div class="ccc-price">
									￥
									<span class="ccc-font-lato">300</span>
									<div class="ccc-num">
										<span class="ccc-font-lato num">98</span>折
									</div>
								</div>
								<div class="ccc-discount-bar ccc-clearfix">
									<div class="ccc-buy">
										<a href="javascript:void(0);" data-info='{"id":"101","name":"现金券·300元","price":"294.00","type":0}' class="ccc-btn-trans">购买</a>
									</div>
									<div class="ccc-cur-price">
										现价：
										<span class="ccc-amount">￥<span class="ccc-font-lato">294</span> </span>
									</div>
								</div>
							</div>
						</div>

						<div class="ccc-discount-item coupon">
							<div class="ccc-discount-bg">
								<img src="images/coupon-bg.png" width="240" height="140" />
							</div>
							<div class="ccc-discount-cont ccc-clearfix">
								<div class="ccc-title">
									现金券
								</div>
								<div class="ccc-price">
									￥
									<span class="ccc-font-lato">1500</span>
									<div class="ccc-num">
										<span class="ccc-font-lato num">96</span>折
									</div>
								</div>
								<div class="ccc-discount-bar ccc-clearfix">
									<div class="ccc-buy">
										<a href="javascript:void(0);" data-info='{"id":"102","name":"现金券·1500元","price":"1440.00","type":0}' class="ccc-btn-trans">购买</a>
									</div>
									<div class="ccc-cur-price">
										现价：
										<span class="ccc-amount">￥<span class="ccc-font-lato">1440</span> </span>
									</div>
								</div>
							</div>
						</div>

						<div class="ccc-discount-item coupon">
							<div class="ccc-discount-bg">
								<img src="images/coupon-bg.png" width="240" height="140" />
							</div>
							<div class="ccc-discount-cont ccc-clearfix">
								<div class="ccc-title">
									现金券
								</div>
								<div class="ccc-price">
									￥
									<span class="ccc-font-lato">3000</span>
									<div class="ccc-num">
										<span class="ccc-font-lato num">92</span>折
									</div>
								</div>
								<div class="ccc-discount-bar ccc-clearfix">
									<div class="ccc-buy">
										<a href="javascript:void(0);" data-info='{"id":"103","name":"现金券·3000元","price":"2760.00","type":0}' class="ccc-btn-trans">购买</a>
									</div>
									<div class="ccc-cur-price">
										现价：
										<span class="ccc-amount">￥<span class="ccc-font-lato">2760</span> </span>
									</div>
								</div>
							</div>
 						-->
 						
						<div class="ccc-discount-item coupon">
							<div class="ccc-discount-bg">
								<img src="images/coupon-bg.png" width="240" height="140" />
							</div>
							<div class="ccc-discount-cont ccc-clearfix">
								<div class="ccc-title">
									现金券
								</div>
								<div class="ccc-price">
									￥
									<span class="ccc-font-lato">500</span>
									<div class="ccc-num">
										<span class="ccc-font-lato num">95</span>折
									</div>
								</div>
								<div class="ccc-discount-bar ccc-clearfix">
									<div class="ccc-buy">
										<a href="javascript:void(0);" data-info='{"id":"104","name":"现金券·500元","price":"475.00","type":0}' class="ccc-btn-trans">购买</a>
									</div>
									<div class="ccc-cur-price">
										现价：
										<span class="ccc-amount">￥<span class="ccc-font-lato">475</span> </span>
									</div>
								</div>
							</div>
						</div>
						<p class="ccc-buy-tips">
							* 现金券适用于车纷享所有产品。不可退还，欢迎购买。</br>
							* tips：春节套餐包不能用现金券购买。
						</p>

					</div>

					<!-- <div class="ccc-form-header" id="ccc-car-taocan">
						<img src="/images/icons/divider-top.png" class="ccc-my-divider divider-top" />
						<h2>
							超值套餐购买
						</h2>
						<img src="/images/icons/simple-divider.png" class="ccc-my-divider" />
					</div>
					<div class="ccc-discount-wrap ccc-clearfix">
						<s:iterator value="#request.packList" id="item" status="i">
							<div class="ccc-discount-item package">
								<div class="ccc-discount-bg">
									<img src="/images/package-bg.png" width="240" height="120" />
								</div>
								<div class="ccc-discount-cont ccc-clearfix">
									<div class="ccc-title">
										${item.cspName}
									</div>
									<div class="ccc-price">
										￥
										<span class="ccc-font-lato">${cc:toInt(item.cspPrice)}</span>
										<div class="ccc-num">
											<s:iterator value="#item.csPackInfoList" id="entry" status="j">
												<span class="ccc-font-lato num">${cc:toInt(entry.cspiValue)}</span>小时
																</s:iterator>
										</div>
									</div>
								</div>
								<div class="ccc-discount-bar ccc-clearfix">
									<div class="ccc-buy">
										<a href="javascript:void(0);" data-info='{"id":"${item.cspId}","name":"${item.cspName}","price":"${lz:digit(item.cspPrice,2)}","type":1}' class="ccc-btn-green">购买</a>
									</div>
									<div class="ccc-details">
										${item.cspProfile}
									</div>
								</div>
							</div>
						</s:iterator>
						<p class="ccc-buy-tips">
							* 白天小时定义：上午9:00--下午17:00（双休日及法定节假日除外）。白天小时优惠套餐包仅适用于汽油车（<b style="color: red">电动汽车不可使用</b>），最小单位按分钟计算，一年有效，欢迎购买。
						</p>
					</div>
				</div> -->
			</div>
			</article>

		</div>
		</div>
		</div>
		</div>
		</div>
		</div>

		<div id="ccc-layer">
			<div id="ccc-overlay"></div>
			<div id="ccc-overpage">
			</div>
			<div id="ccc-overclose">
				<button>
					关闭
				</button>
			</div>
		</div>

		<div id="ccc-discount-confirm" class="ccc-confirm">
			<div class="ccc-confirm-cont">
				<img src="/images/colorful-bar.png" class="ccc-colorful-bar">
				<h3>
					购买确认
				</h3>
				<div class="ccc-confirm-desc">
					<div class="ccc-bundle">
						<table width="100%">
							<colgroup>
								<col width="">
								<col width="80">
								<col width="20">
								<col width="55">
								<col width="20">
								<col width="80">
							</colgroup>
							<tr>
								<td class="item">
									<span id="purName"></span>
								</td>
								<td class="price">
									￥
									<span class="ccc-font-lato" id="purPr"></span>
								</td>
								<td>
									×
								</td>
								<td class="num">
									<div class="ccc-num-control">
										<input type="text" value="1" maxlength="2" id="purNum" class="ccc-font-lato" />
										<button id="purNumPlus"></button>
										<button id="purNumMinus"></button>
										<div id="ccc-single" class="ccc-font-lato">
											1
										</div>
									</div>
								</td>
								<td>
									=
								</td>
								<td class="sum">
									￥
									<span class="ccc-font-lato" id="purSum"></span>
								</td>
							</tr>
						</table>
					</div>
					<p>
						*
						<span id="purTip"></span>
					</p>
					<div class="ccc-confirm-opt">
						<button class="ccc-cfm-close ccc-btn-white">
							取消
						</button>
						<button class="ccc-cfm-true ccc-cfm-close ccc-btn-green" id="ccc-true">
							确认购买
						</button>
					</div>
				</div>
			</div>
		</div>
		<div id="ccc-global-tips">
			<i></i><span>正在加载...</span>
		</div>
		<script src="/js/jquery-1.10.1.min.js" type="text/javascript"></script>
		<script src="/js/ccclubs.global.js?v=${lz:config('version')}" type="text/javascript"></script>
		<script>
			$(document).ready(function() {
				$(document).on('click','.ccc-buy a',function(){
					var id = $(this).data('info').id;
					var name = $(this).data('info').name;
					var price = $(this).data('info').price;
					var type = $(this).data('info').type;
					var tip = (type==0) ? '现金券适用于车纷享所有产品。不可退还，请谨慎购买。':'* 白天小时优惠套餐包仅适用于汽油车（<b style="color:red;">电动汽车不可使用</b>）。一年有效，请谨慎购买。';
					$('#ccc-single').css('display',((type==0) ? 'none':'block'));
					$('#purName').text(name);
					$('#purPr, #purSum').text(price);
					$('#purTip').html(tip);
					$('#purNum').val(1);
					$('#ccc-true').data('id',id).data('type',type);
					showLayer();
					$('#ccc-discount-confirm').addClass('ccc-show');
					return false;
				});
				
				$(document).on('click','.ccc-cfm-close, #ccc-overclose',function(event){
					event.stopPropagation();
					$('#ccc-discount-confirm').removeClass('ccc-show');
					closeLayer();
					if ($(this).hasClass('ccc-cfm-true')) {
						var num = parseInt($('#purNum').val());
						var id = $('#ccc-true').data('id');
						var type = $('#ccc-true').data('type');
						(type==0) ? (buycoupon(id,${member==null?-1:member.csmId},num)):(buypack(id,${member==null?-1:member.csmId}));
					}
					return false;
				});
				
				$(document).on('click','#purNumPlus',function(){
					var num = parseInt($('#purNum').val());
					if (num==99) return;
					$('#purNum').val(num+1);
					setSum();
				});
				
				$(document).on('click','#purNumMinus',function(){
					var num = parseInt($('#purNum').val());
					if (num==1) return;
					$('#purNum').val(num-1);
					setSum();
				});
				
				$(document).on({
					keydown: function(event) {
						if (!((event.keyCode>=48 && event.keyCode<=57)||(event.keyCode>=96 && event.keyCode<=105)||(event.keyCode>=37 && event.keyCode<=40)||event.keyCode==8||event.keyCode==46)) {
							return false;
						}
					},
					keyup: function() {
						var val = $('#purNum').val().replace(/[^\d]/g,'');
						if (val == '' || val == 0) val = 1;
						this.value = parseInt(val);
						setSum();
					}
				},'#purNum');
				
				function setSum() {
					var price = parseInt($('#purPr').text());
					var num = parseInt($('#purNum').val().replace(/[^\d]/g,''));
					$('#purSum').text(parseInt(price*num).toFixed(2));
				}
				
			});
			
		function buycoupon(type,member,num){
					var ajax = {
					url: "/my/discount_buycoupon.html?t="+new Date().getTime(),
					type: "POST",
					data: {
						member:member,
						type:type,
						num:num
					},
						async: true,
						success: function(data) {
							switch (data) {
								case "100":
									showTips("购买现金券成功！","succ",3);
									break;
								case "101":
									location.href = '/login.html?from=/discount.html';
									break;
								case "102":
									showTips("亲，只有本人才能购买现金券哦～","error",3);
									break;
								case "103":
									showTips("亲，您的充值帐户余额不足哦～","error",3);
									break;
								case "104":
									showTips("亲，请选择一个现金券面额再购买哦～","error",3);
									break;
								default:
									showTips("系统出问题啦，请联系客服！","error",3);
									return;
							}
						}
					}
					$.ajax(ajax);
		            return false;
		}
		
		function buypack(pack,member){
					var ajax = {
					url: "/my/discount_buypack.html?t="+new Date().getTime(),
					type: "POST",
					data: {
						member:member,
						pack:pack
					},
						async: true,
						success: function(data) {
							switch (data) {
								case "100":
									showTips("购买超值套餐成功！","succ",3,function(){
										location.href = '/discount.html';
									});
									break;
								case "101":
									location.href = '/login.html?from=/discount.html';
									break;
								case "102":
									showTips("亲，只有本人才能购买现超值套餐哦～","error",3);
									break;
								case "103":
									showTips("亲，您选择的套餐已经不再出售了哦～","error",3,function(){
										location.href = '/discount.html';
									});
									break;
								case "104":
									showTips("亲，您的套餐还没用完，不要贪心哦～","error",3);
									break;
								case "9999":
									showTips("系统出问题啦，请联系客服！","error",3);
									break;
								default:
									showTips(data,"error",3);
									return;
							}
						}
					}
					$.ajax(ajax);
		            return false;
		}
		</script>
	</body>
</html>
