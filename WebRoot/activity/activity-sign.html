<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<meta name="renderer" content="webkit">
		<title>车纷享带你回家，预约报名${lz:config('html_title_summary')}</title>
		<meta name="keywords" content="${lz:config('html_header_keyword')}" />
		<meta name="description" content="${lz:config('html_header_description')}" />
		<link rel="stylesheet" href="/css/ccclubs.global.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/ccclubs.timepicker.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/ccclubs.select2.css?v=${lz:config('version')}" type="text/css" />
		<link rel="stylesheet" href="/css/spring-index.css?v=${lz:config('version')}" type="text/css" />
	</head>

	<body>
		<div id="bmb">
			<div id="bmb-2" class="ccc-acc-form">
				<div class="ccc-form-opt">
					<p>
						* 咨询电话：0571-88190338
					</p>
				</div>
				<s:if test="#session.ccclubs_web_login!=null">
					<div class="ccc-member">
						<div class="ccc-icon">
							<a href="/my/account_setheader.html"><img src="${cc:isNullOrEmpty(ccclubs_web_login.csmHeader)?'/images/member-thumb.png':ccclubs_web_login.csmHeader}" /> </a>
						</div>
						<div class="ccc-info">
							<div class="ccc-welcome-text">
								${cc:getTimeDisplay()}，
								<a href="/my/" class="ccc-link" target="_blank">${ccclubs_web_login.csmName==null ? cc:mobile2Star(ccclubs_web_login.csmMobile) : ccclubs_web_login.csmName}</a>
								<em></em>
							</div>
							<div class="ccc-status">
								<div class="ccc-operation">
									<s:if test="#request.isSign">
										<a class="ccc-btn-green" href="javascript:;">已报名</a><a class="ccc-link" href="/activity/activity-reserve.html">马上去抢购套餐</a>
									</s:if>
									<s:else>
										<a class="ccc-btn-white" href="javascript:;">未报名</a>
									</s:else>
								</div>
							</div>
						</div>
					</div>
				</s:if>
				<s:if test="#request.isSign==false&&#request.csChjSign==null">
					<h2>
						预约报名
						<span style="float: right; font-size: 12px; font-weight: normal;"><a href="/activity/index.html?src=sign" class="ccc-link">返回春节活动详情</a> </span>
					</h2>
					<div class="ccc-form-divider"></div>
					<div class="ccc-form-item">
						<label class="ccc-label">
							取车时间
							<font style="color: red;">*</font>
						</label>
						<div class="ccc-input-wrap">
							<input id="start" type="text" value="2014-01-30 , 17:00" id="csmiContact" class="ccc-input ccc-time-picker" style="width: 210px;">
						</div>
					</div>
					<div class="ccc-form-item">
						<label class="ccc-label">
							还车时间
							<font style="color: red;">*</font>
						</label>
						<div class="ccc-input-wrap">
							<input type="text" id="finish" value="2014-02-07 , 09:00" id="csmiContact" class="ccc-input ccc-time-picker" style="width: 210px;">
						</div>
					</div>

					<div class="ccc-form-item">
						<label class="ccc-label">
							取车网点
							<font style="color: red;">*</font>
						</label>
						<div class="ccc-select-wrap">
							<em></em>
							<select id="district" style="width: 40%" class="ccc-input">
								<s:iterator value="#request.areas" id="item" status="i">
									<option value="${item.spId}" ${item.spId==5?'selected' :''}>
										${item.spName}
									</option>
								</s:iterator>
							</select>
							<select id="parking-lot" style="width: 58%" class="ccc-input">
								<option selectid="0"></option>
							</select>
						</div>
						<a class="ccc-link" style="margin-left: 20px;" target="_blank" href="/parkinglots.html?src=spring&amount=100.00">查看网点分布</a>
					</div>
					<div class="ccc-form-item">
						<label class="ccc-label">
							车型
							<font style="color: red;">*</font>
						</label>
						<div class="ccc-select-wrap" style="width: 40%;">
							<select id="cscsModel" style="width: 100%;" class="ccc-input">
								<option value="1006">
									别克凯越
								</option>
								<option value="1003">
									奔驰Smart
								</option>
								<option value="1004">
									名爵MG3
								</option>
							</select>
						</div>
					</div>

					<div class="ccc-form-item">
						<label class="ccc-label">
							目的地
							<font style="color: red;">*</font>
						</label>
						<div class="ccc-input-wrap">
							<input type="text" id="cscsTarget" placeholder="请大概输入目的地，比如：浙江宁波市海曙区" id="csmiContact" class="ccc-input">
						</div>
					</div>

					<div class="ccc-form-opt">
						<a class="ccc-account-save ccc-btn-green" onclick="saveSign()" href="javascript:;">提交报名</a>
					</div>

				</s:if>
				<div class="ccc-time-conflicts" id="timeConflicts"
					<s:if test="#request.isSign">
						style="display:block;"
					</s:if>
					>
					<i>报名成功！</i>
					<p>
						请于2014年1月5日11点整回来参加【春节套餐】抢购活动。
					</p>
					<p style="font-size: 12px;">
						(为了不影响当天抢购，要确保帐户余额不少于100元哦，
						<a href="/my/alipay.html?src=spring" class="ccc-link" target="_blank">马上充值</a>)
					</p>
					<p style="margin-top: 20px;">
						tips：车纷享联合杭州银行，注册办卡有奖励！
					</p>
					<p>
						1、如果您持有杭州银行IC卡，车纷享工作人员将上门为您激活“车钥匙功能”，就能领取100元现金券办卡奖励；
					</p>
					<p>
						2、如果您没有杭州银行IC卡，请提前到杭州银行指定网点办理杭州银行IC卡，并及时与车纷享客服取得联系，车纷享工作人员将上门为您激活“车钥匙功能”，就能领取100元现金券办卡奖励；
					</p>

				</div>
			</div>
		</div>

		<div id="ccc-global-tips">
			<i></i><span>正在加载...</span>
		</div>
		<script src="/js/jquery-1.10.1.min.js" type="text/javascript"></script>
		<script src="/js/ccclubs.global.js?v=${lz:config('version')}" type="text/javascript"></script>
		<script src="/js/ccclubs.select2.min.js?v=${lz:config('version')}" type="text/javascript"></script>
		<script src="/js/jquery-ui-1.10.1.min.js" type="text/javascript"></script>
		<script src="/js/jquery-ui-timepicker.min.js?v=${lz:config('version')}" type="text/javascript"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				/* Time Picker */
				var timeCur = new Date();
				// CCClubs Customization
				$.timepicker.regional['CCClubs']={
					minDate: new Date(timeCur.getFullYear(), timeCur.getMonth(), timeCur.getDate(), 0, 0)
				};
				$.timepicker.setDefaults($.timepicker.regional['CCClubs']);
				$('.ccc-time-picker').datetimepicker().attr('readonly','readonly');
				
				$('#district').select2({
					placeholder: '选择区域',
					minimumResultsForSearch: -1
				});
				setArea();
				$('#cscsModel').select2({
					placeholder: '选择车型',
					minimumResultsForSearch: -1
				});
				$('#district').change(setArea);
			});
			
			function setArea(){
					var objselect=$('#district').get(0);
		　　　  var indexselect=objselect.selectedIndex;
		　　　  var valselect=objselect.options[indexselect].value;
					var value =valselect ;
					$("#parking-lot").html("<option></option>");
					$.when(
						$.getJSON("/ajax_outletsByAreaCanorder.html",{area:value},function(data) {
				                //遍历JSON中的每个entry 
				                $.each(data, function(entryIndex, entry) {
				                	var info = '<option value="'+entry.csoId;
				                	if(1065== entry.csoId){
				                		info=info+'"  selected >'+entry.csoName+'</option>';
				                	}else{
				                		info= info+'">'+entry.csoName+'</option>';
				                	}
				                    //var info = "<li onclick=javascript:setNode('" + entry.csoName + "','" + entry.csoId + "')>" + entry.csoName + "</li>";
				                    $(info).appendTo("#parking-lot");
				                });
				             })
				          ).done(function() {
								$('#parking-lot').select2({
									placeholder: '选择网点',
									minimumResultsForSearch: -1
								});
						 });
				}
			
			
			function saveSign(){
				var start = $.trim($('#start').val()).replace(' , ',' ');
				var finish = $.trim($('#finish').val()).replace(' , ',' ');
				if (dateDiff('M', start, '2014-01-30 17:00') < 0) {
					showTips("亲，春节租车，需要选择在1月30日17点前提车","error",7);
					return false;
				}
				if (dateDiff('M', '2014-02-07 09:00', finish) < 0) {
					showTips("亲，春节租车，需要选择在2月7日9点后还车","error",7);
					return false;
				}
			
				var objselect=$('#parking-lot').get(0);
				var indexselect=objselect.selectedIndex;
		　　  var valselect=objselect.options[indexselect].value;
				if(valselect==''){
					showTips("亲，需要选择一个取车网点哦～查看网点分布确定网点位置。","error",7);
					return false;
				}
				
				var cscsTarget = $.trim($('#cscsTarget').val());
				var cscsModel =$('#cscsModel option:selected').val() ;
				
	            var reg = /^[\u4e00-\u9fa5]{1,}$/;
	            if(cscsTarget==null || cscsTarget.length<3)
	            {
	            	showTips("亲，要认真填写目的地哦~，比如：浙江宁波市海曙区","error",5);
		            return false;
	            }
	            
				var ajax = {
				url: "/activity/activity-signSave.html",
				type: "POST",
				data: {
					cscsTakeTime: start+":00",
					cscsRetTime: finish+":00",
					cscsModel:cscsModel,
					cscsOutlets:valselect,
					cscsTarget:cscsTarget
				},
					async: true,
					success: function(data) {
						switch (data) {
							case "100":
								showTips("恭喜您，报名成功！","succ",3,function(){
									location.href = '/activity/activity-sign.html';
								});
								break;
							case "101":
								location.href = '/login.html?from=/activity/activity-sign.html';
								break;
						   case "102":
								showTips("需要选择一个取车时间。","succ",3);
								break;
							case "103":
								showTips("需要选择一个还车时间。","error",3);
								break;
						    case "104":
								showTips("需要选择一款车型。","error",3);
								break;
							case "105":
								showTips("需要选择一个取车网点","error",3);
								break;
						    case "106":
								showTips("需要填写一个目的地。","error",3);
								break;
							case "107":
								showTips("需要先完善资料才能报名。","error",3,function(){
									location.href = '/register_step2.html';
								});
								break;
							case "108":
								showTips("亲，您已经报过名了，坐等1月5日11点抢购吧！","error",3);
								break;
							case "109":
								showTips("亲，活动报名已经截止了～","error",3);
								break;
							default:
								showTips("系统出问题啦，请联系客服！","error",7);
								return;
						}
					}
				}
				$.ajax(ajax);
	            return false;
			}
			
	</script>
	</body>
</html>