<script type="text/javascript">
	<s:if test="#request.nosign==1">
		location.href="${basePath}/activity/newyear2015/activity.html";
	</s:if>
</script>

<div class="activity-body">
	<div class="activity-statu-split"></div>

	<div style="height: 242px; width: 100%;">
		<div class="buytitle">
		</div>
		<div class="timecont">
			<div class="timebar"></div>
		</div>
		
		<s:if test="#request.certification!=1">
			<a href="${basePath}/my/account_changelic.html?from=/activity/newyear2015/activity.html" target="_blank"><div class="sheep-icon"></div></a>
		</s:if>
	</div>
	
	<!-- 第一批活动 -->
	<div class="car-cont first-meal" style="position: relative;">
		<div class="border-first NEW_YEAR_PACK_2015_KY" >
			<div class="card">
				<div class="imgcar img-bkky-first">
					<div class="tag">
						别克凯越
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4662</s></div></div>
				<div class="price">
					<div class="promotion-price">￥1680</div>
					<div class="number">16辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
		
		<div style="width: 80px; height: 100%; float: left;"></div>
		
		<div class="border-first NEW_YEAR_PACK_2015_MG">
			<div class="card">
				<div class="imgcar img-mg-first">
					<div class="tag">
						名爵MG3
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4080</s></div></div>
				<div class="price">
					<div class="promotion-price">￥1480</div>
					<div class="number">4辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
	</div>
	
	<div class="waitsplit-second">
		<div class="waitsplit"></div>	
	</div>
	
	<!-- 第二批活动 -->
	<div class="car-cont second-meal">
		<div class="border NEW_YEAR_PACK_2015_KY">
			<div class="card">
				<div class="imgcar img-bkky">
					<div class="tag">
						别克凯越
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4662</s></div></div>
				<div class="price">
					<div class="promotion-price">￥2080</div>
					<div class="number">45辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
		
		<div class="border NEW_YEAR_PACK_2015_MG">
			<div class="card">
				<div class="imgcar img-mg">
					<div class="tag">
						名爵MG3
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4080</s></div></div>
				<div class="price">
					<div class="promotion-price">￥1880</div>
					<div class="number">13辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
		
		<div class="border NEW_YEAR_PACK_2015_SMART">
			<div class="card">
				<div class="imgcar img-smart">
					<div class="tag">
						奔驰Smart
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4680</s></div></div>
				<div class="price">
					<div class="promotion-price">￥1880</div>
					<div class="number">4辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
	</div>
	
	<div class="waitsplit-third">
		<div class="waitsplit"></div>	
	</div>
	
	<!-- 第三批活动 -->
	<div class="car-cont third-meal">
		<div class="border NEW_YEAR_PACK_2015_KY">
			<div class="card">
				<div class="imgcar img-bkky">
					<div class="tag">
						别克凯越
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4662</s></div></div>
				<div class="price">
					<div class="promotion-price">￥2580</div>
					<div class="number">?辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
		
		<div class="border NEW_YEAR_PACK_2015_MG">
			<div class="card">
				<div class="imgcar img-mg">
					<div class="tag">
						名爵MG3
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4080</s></div></div>
				<div class="price">
					<div class="promotion-price">￥2380</div>
					<div class="number">?辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
		
		<div class="border NEW_YEAR_PACK_2015_SMART">
			<div class="card">
				<div class="imgcar img-smart">
					<div class="tag">
						奔驰Smart
					</div>
					<div class="img-meal"></div>
				</div>
				<div class="market-price"><div class="cross"><s style="">市场价：￥4680</s></div></div>
				<div class="price">
					<div class="promotion-price">￥2380</div>
					<div class="number">?辆</div>
				</div>
				<div class="promptlybuy promptlybuy-black">即将开始</div>
			</div>
		</div>
	</div>
	
	<%@ include file="/activity/newyear2015/activity-rule.html"%>
	
	<div id="dialogContainer" class="dialog_container">
    <div class="dialog_box">
	    <div class="dialog_con">
	        <div><a href="javascript:" id="dialogClose" class="dialog_close">X</a></div>
	        <div id="dialogBody" class="dialog_body">
		        <div id="dialogTitle" class="dialog_title">恭喜您，成功抢到！</div>
		        <div id="dialogText"  class="dialog_text">
		        	通过驾驶证认证之后可以抢套餐包
		        </div>
		        
		        <div class="dialog_line"></div>
		        
		        
		        <div class="dialog_btn_con">
		        	<div class="button lbtn">确定</div>
		        	<div class="button rbtn">取消</div>
		        </div>
		        
	        </div>
	     </div>
    </div>
	
	<script type="text/javascript">
		 //字符串转日期格式，strDate要转为日期格式的字符串
        Date.prototype.convertDate = function (date) {   
			var flag = true;   
			var dateArray = date.split("-");  
			if (dateArray.length != 3) {  
			dateArray = date.split("/");  
			if (dateArray.length != 3) {  
			return null;  
			}  
			flag = false;  
			}  
			var newDate = new Date();  
			if (flag) {  
			// month从0开始  
			newDate.setFullYear(dateArray[0], dateArray[1] - 1, dateArray[2]);  
			}  
			else {  
			newDate.setFullYear(dateArray[2], dateArray[1] - 1, dateArray[0]);  
			}  
			newDate.setHours(0, 0, 0);  
			return newDate;  
		};  
		
		 function parseDate(strDate, strFormat){  
	       if(typeof strDate != "string"){  
	            return new Date();  
	       }  
	      var longTime = Date.parse(strDate);  
	      if(isNaN(longTime)){  
	          if(typeof strFormat === 'undefined'){  
	              this.debug('请输入日期的格式');  
	             return new Date();  
	          }  
	          var tmpDate = new Date();  
	          var regFormat = /(\w{4})|(\w{2})|(\w{1})/g;  
	          var regDate = /(\d{4})|(\d{2})|(\d{1})/g;  
	          var formats = strFormat.match(regFormat);  
	          var dates = strDate.match(regDate);  
	          if(typeof formats !== 'undefined' && typeof dates !== 'undefined' && formats.length == dates.length){  
	            for(var i = 0; i < formats.length; i++){  
	              var format = formats[i];  
	              if(format === "yyyy"){  
	                tmpDate.setFullYear(parseInt(dates[i], 10));  
	              }else if(format == "yy"){  
	                var prefix = (tmpDate.getFullYear() + "").substring(0, 2);  
	                var year = (parseInt(dates[i], 10) + "").length == 4? parseInt(dates[i], 10): prefix + (parseInt(dates[i], 10) + "00").substring(0, 2);  
	                var tmpYear = parseInt(year, 10);  
	                tmpDate.setFullYear(tmpYear);  
	              }else if(format == "MM" || format == "M"){  
	                tmpDate.setMonth(parseInt(dates[i], 10) - 1);  
	              }else if(format == "dd" || format == "d"){  
	                tmpDate.setDate(parseInt(dates[i], 10));  
	              }else if(format == "HH" || format == "H"){  
	                tmpDate.setHours(parseInt(dates[i], 10));  
	              }else if(format == "mm" || format == "m"){  
	                tmpDate.setMinutes(parseInt(dates[i], 10));  
	              }else if(format == "ss" || format == "s"){  
	                tmpDate.setSeconds(parseInt(dates[i], 10));  
	              }  
	            }  
	           return tmpDate;  
	         }  
	          return tmpDate;  
	        }else{  
	          return new Date(longTime);  
	        }  
	    }
        
		function countDown(val){
			//"${oddtime}"
			//var end_time = time.getTime(),	//月份是实际月份-1
			//current_time = new Date().getTime(),
			var time = parseInt(val);
			sys_second = time/1000;
			var day = Math.floor((sys_second / 3600) / 24);
			var hour = Math.floor((sys_second / 3600) % 24);
			var minute = Math.floor((sys_second / 60) % 60);
			var second = Math.floor(sys_second % 60);

			var str =  (day<10?"0"+day:day);
			str += ':'+(hour<10?"0"+hour:hour); 	//计算小时
			str += ':'+(minute<10?"0"+minute:minute);//计算分
			str += ':'+(second<10?"0"+second:second);// 计算秒
			return str;
		}
		
		$(document).ready(function() {
		
			//=============初始化弹窗组件=============

			var window_close = function(){
				$("#dialogContainer").hide();
			};
			
			var window_show = function(){
				$("#dialogContainer").show();
			};
			
	        $("#dialogClose").bind("click", function(){
	        	window_close();
	        	$("#dialogClose").trigger("close");
	        });
	        
	        $("#dialogContainer").find(".lbtn").bind("click", function(){
        		window_close();
         		$(this).trigger("close");
         		$(this).trigger("sure");
	        });
	         
	        $("#dialogContainer").find(".rbtn").bind("click", function(){
	        	window_close();
         		$(this).trigger("close");
         		$(this).trigger("cancel");
	        });
	        
	        function showTips(title, content, closeHandler, yesText){
				$("#dialogTitle").html(title);
				$("#dialogText").html(content);
				$("#dialogContainer").find(".dialog_btn_con").css({width:"180px"});
				$("#dialogContainer").find(".rbtn").hide();
				$("#dialogContainer").show();
				if(yesText){
					$("#dialogContainer").find(".lbtn").html(yesText);
				}
				if(closeHandler){
					$("#dialogContainer").find(".lbtn").unbind("close");
					$("#dialogContainer").find(".lbtn").bind("close", function(){
						closeHandler();
						$("#dialogContainer").find(".lbtn").unbind("close");
					});
					//$("#dialogClose").bind("close", closeHandler);
				}
			}
			
			function confirmTips(title, content, yesHandler, noHandler, yesText, noText, closeHandler){
				$("#dialogTitle").html(title);
				$("#dialogText").html(content);
				$("#dialogContainer").find(".dialog_btn_con").css({width:"360px"});
				$("#dialogContainer").find(".rbtn").show();
				$("#dialogContainer").show();
				yesText = yesText || "确定";
				noText = noText || "取消";
				var lbtn = $("#dialogContainer").find(".lbtn").text(yesText);
				var rbtn = $("#dialogContainer").find(".rbtn").text(noText);
				lbtn.unbind("sure");
				rbtn.unbind("cancel");
				$("#dialogClose").unbind("close");
				if(yesHandler){
					lbtn.bind("sure", function(){
						lbtn.unbind("sure");
						yesHandler();
					});
				}
				if(noHandler){
					rbtn.bind("cancel", function(){
						rbtn.unbind("cancel");
						noHandler();
					});
				}
				if(closeHandler){
					$("#dialogClose").bind("close", function(){
						$("#dialogClose").unbind("close");
						closeHandler();
					});
				}
			}
				
			function refresh(){
				location.reload(true);
			}	
			
			//====================================================================================
			//立即抢购
			function buy(cspId, button){
				var ajaxOptions = {
					url: "${basePath}/activity/newyear2015/package-buy.html?t="+new Date().getTime(),
					type: "POST",
					async: true,
					dataType: "json",//返回值类型 一般设置为json
					data:{"temp":"${time}", cspId:cspId},
					success: function(data) {
						$(button).removeClass("promptlybuy-gray").addClass("promptlybuy-red").text("立即抢购");
						switch (data) {
							case 1001:
							 		showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>请重新登陆</font>", function(){
										location.href="/login.html?from=/activity/newyear2015/activity.html";
									}, "确定");
								break;
							case 1002:
									showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>非法请求！</font>", function(){
										location.href="/login.html?from=/activity/newyear2015/activity.html";
									}, "确定");
								break;
							case 1003:
									showTips("提示", "您已经购买了该套餐", function(){
										refresh();
									}, "确定");
								break;
							case 1004:
									confirmTips("提示", "请点击“付款”完成支付", doPay, cancelbuy, "付款", "重新选择", refresh);
								break;
							case 1007:
									showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>该套餐已被抢购一空</font>", function(){
										refresh();
									}, "重新选择");
								break;
							case 1008:
									confirmTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>您的驾驶证还未通过认证</font>", function(){
										window.open("${basePath}/my/account_changelic.html?from=/activity/newyear2015/activity.html");
										refresh();
									}, refresh, "去认证", "取消");
								break;
							case 1010:
									var timemillis = 30 * 1000 * 60;
									var minute = Math.floor((timemillis / 60) % 60);
									var second = Math.floor(timemillis % 60);
									confirmTips("恭喜您，成功抢到！", "请在30分钟内完成付款，否则订单会失效</br><span id='remainTimeText' style='font-size:18px;color:red'>剩余支付时间："+minute+"分"+second+"秒</span>", doPay, cancelbuy, "付款", "重新选择", refresh);
									doRemainTimer(timemillis);
								break;
							default:
									showTips("抢购失败！", "请刷新重试", function(){
										refresh();
									}, "确定");
								break;
						}
						
					}
				};
				$.ajax(ajaxOptions);
			}
			
			function doPay(){
				var ajaxOptions = {
					url: "${basePath}/activity/newyear2015/package-doPay.html?t="+new Date().getTime(),
					type: "POST",
					async: true,
					dataType: "json",//返回值类型 一般设置为json
					data:{"temp":"${time}"},
					success: function(data) {
						switch (data) {
							case 1001:
							 		showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>请重新登陆</font>", function(){
										location.href="/login.html?from=/activity/newyear2015/activity.html";
									}, "确定");
								break;
							case 1002:
									showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>非法请求！</font>", function(){
										location.href="/login.html?from=/activity/newyear2015/activity.html";
									}, "确定");
								break;
							case 1003:
									showTips("提示", "您已经购买了该套餐", function(){
										refresh();
									}, "确定");
								break;
							case 1004:
									showTips("<font style='color:black'>非常抱歉</font>", "<font style='color:gray;'>您已超出了支付时间，订单已失效！</font>", function(){
										refresh();
									}, "重新选择");
								break;
							case 1005:
									showTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>找不到相关订单信息！</font>", function(){
										refresh();
									}, "重新选择");
								break;
							case 1006:
									showTips("<font style='color:black'>支付失败</font>", "<font style='color:gray;'></font>", function(){
										refresh();
									}, "确定");
								break;
							case 1007:
									confirmTips("<font style='color:black'>对不起！</font>", "<font style='color:gray;'>由于您的余额不足，本次支付失败！</font>", function(){
										window.open("${basePath}/my/alipay.html");
										refresh();
									},function(){
										refresh();
									}, "去充值", "关闭", refresh);
								break;
							case 1010:
									showTips("付款成功！", "请于2015年2月1日参与抢车！", function(){
										refresh();
									}, "确定");
								break;
							default:
									showTips("对不起！", "支付失败", function(){
										refresh();
									}, "确定");
								break;
						}
					}
				};
				$.ajax(ajaxOptions);
			}
			
			function cancelbuy(){
				var ajaxOptions = {
					url: "${basePath}/activity/newyear2015/package-cancelbuy.html?t="+new Date().getTime(),
					type: "POST",
					async: true,
					dataType: "json",//返回值类型 一般设置为json
					data:{"temp":"${time}"},
					success: function(data) {
						refresh();
					}
				};
				$.ajax(ajaxOptions);
			}
			
			function remainCount(b, t){
				var x = [[1421337000000, 0, 0],
						 [1421325300000, 1, 1],
						 [1421322300000, 2, 1],
						 [1421322060000, 3, 1],
						 [1421321820000, 3, 2],
						 [1421320440000, 4, 2],
						 [1421316240000, 6, 3],
						 [1421314680000, 6, 4]
						], r = 0;
					
				for(var i =0 ; i<x.length; i++){
					if(x[i][0]>b){
						var j =(i==x.length-1?x.length:i+1);
						if(t == 0){
							r =  x[j][1];
						}else if(t == 1){
							r =  x[j][2];
						}
					}
				}
				return r;
			}
			
			function remain3Count(b, t){
				var x = [[1421500680000, 6, 0, 5],
						 [1421496660000, 6, 1, 5],
						 [1421488320000, 7, 1, 5],
						 [1421471400000, 9, 1, 5],
						 [1421466120000, 11, 1, 5],
						 [1421464380000, 11, 2, 5],
						 [1421458080000, 12, 2, 5],
						 [1421414520000, 14, 2, 6],
						 [1421409780000, 14, 3, 6],
						 [1421398200000, 15, 3, 6],
						 [1421396400000, 17, 4, 7],
						 [1421399640000, 17, 5, 7],
						 [1421392980000, 18, 5, 7]
						], r = 0;
					
				for(var i=x.length-1;i>=0;i--){
					if(x[i][0]>b){
						if(t == 0){
							r =  x[i+1][1];
						}else if(t == 1){
							r =  x[i+1][2];
						}else if(t == 2){
							r =  x[i+1][3];
						}
						break;
					} 
				}
				
				if(r == 0){
					if(t == 0){
						return 6;
					}else if(t == 1){
						return 0;
					}else if(t == 2){
						return 5;
					}
				}
				
				return r;
			}
			
			//初始化套餐数据
			//var end_date = new Date().convertDate("12/1/2015");
			//var end_date = parseDate(time, "yyyy-MM-dd HH:mm:ss");
			var ajaxOptions = {
				url: "${basePath}/activity/newyear2015/package-getActivityData.html?t="+new Date().getTime(),
				type: "POST",
				async: true,
				dataType: "json",//返回值类型 一般设置为json
				data:{"temp":"${time}"},
				success: function(data) {
					if(data.step == 1){
						var meals = data.meals;
						for(key in meals){
							var meal = meals[key];
							$(".first-meal").find("."+meal.pack.cspFlag).find(".promotion-price").text("￥"+meal.pack.cspPrice);
							$(".first-meal").find("."+meal.pack.cspFlag).find(".number").text("仅剩"+meal.remain+"辆");
							var button = $(".first-meal").find("."+meal.pack.cspFlag).find(".promptlybuy");
							if(meal.remain == 0){
								button.removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已抢光");
							}else{
								button.removeClass("promptlybuy-black").addClass("promptlybuy-red").text("立即抢购");
								button.bind("click", {meal : meal}, function(e){
									$(this).unbind("click");
									$(this).removeClass("promptlybuy-red").addClass("promptlybuy-gray").text("正在抢购...");
									
									buy(e.data.meal.pack.cspId, $(this));
								});
							}
						}
					}
				
					var ntm ;//parseInt("${tmpv}");
					if(isNaN(ntm)) ntm = new Date().getTime();
					if(data.step == 2){
						var meals = data.meals;
						for(key in meals){
							var meal = meals[key];
							
							var m = meal.remain;
							if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_KY"){
								m = remainCount(ntm, 0);
							}else if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_MG"){
								m = remainCount(ntm, 1);
							}
							if(meal.remain < m){
								m = meal.remain;
							}
							if(m<0){m=0;}
							
							$(".second-meal").find("."+meal.pack.cspFlag).find(".promotion-price").text("￥"+meal.pack.cspPrice);
							$(".second-meal").find("."+meal.pack.cspFlag).find(".number").text("仅剩"+m+"辆");
							//$(".first-meal").find("."+meal.pack.cspFlag).find(".promptlybuy").removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已结束");
							
							var button = $(".second-meal").find("."+meal.pack.cspFlag).find(".promptlybuy");
							$(".waitsplit-second").hide();
							$(".first-meal").hide();
							if(m == 0){
								button.removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已抢光");
							}else{
								
								button.removeClass("promptlybuy-black").addClass("promptlybuy-red").text("立即抢购");
								button.bind("click", {meal : meal}, function(e){
									$(this).unbind("click");
									$(this).removeClass("promptlybuy-red").addClass("promptlybuy-gray").text("正在抢购...");
									
									buy(e.data.meal.pack.cspId, this);
								});
								
								if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_SMART"){
									if(ntm>1421337599000){
										button.unbind("click");
										button.removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已结束");
									}
								}
							}
							
						}
					}
					
					if(data.step == 3){
						var meals = data.meals;
							for(key in meals){
								var meal = meals[key];
								
								var m = meal.remain;
								if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_KY"){
									m = remain3Count(ntm, 0);
								}else if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_MG"){
									m = remain3Count(ntm, 1);
								}else if(meal.pack.cspFlag == "NEW_YEAR_PACK_2015_SMART"){
									m = remain3Count(ntm, 2);
								}
								if(meal.remain < m){
									m = meal.remain;
								}
								if(m<0){m=0;}
								
								$(".waitsplit-second").hide();
								$(".waitsplit-third").hide();
								$(".first-meal").hide();
								$(".second-meal").hide();
								$(".timebar").parent().hide();
								$(".timebar").parent().parent().css({height : "142px"});
								
								$(".third-meal").find("."+meal.pack.cspFlag).find(".promotion-price").text("￥"+meal.pack.cspPrice);
								$(".third-meal").find("."+meal.pack.cspFlag).find(".number").text("仅剩"+m+"辆");
								var button = $(".third-meal").find("."+meal.pack.cspFlag).find(".promptlybuy");
								if(m == 0){
									button.removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已抢光");
								}else{
									button.removeClass("promptlybuy-black").addClass("promptlybuy-red").text("立即抢购");
									button.bind("click",{meal : meal, bt:button}, function(e){
										$(e.data.bt).unbind("click");
										$(this).removeClass("promptlybuy-red").addClass("promptlybuy-gray").text("正在抢购...");
										
										buy(e.data.meal.pack.cspId, $(this));
									});
								}
								
								if(ntm>1421510399000){
									button.removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已结束");
									$(".third-meal").find("."+meal.pack.cspFlag).find(".number").text("");
									button.unbind("click");
								}
							}
					}
					 
					if(data.step > 3){
						$(".waitsplit-second").hide();
						$(".waitsplit-third").hide();
						$(".first-meal").hide();
						$(".second-meal").hide();
						$(".timebar").parent().hide();
						$(".timebar").parent().parent().css({height : "142px"});
						$(".sheep-icon").hide();
						$(".third-meal").find(".number").text("0辆");
						var button = $(".third-meal").find(".promptlybuy").removeClass("promptlybuy-black").addClass("promptlybuy-gray").text("已结束");
					}else{
						if(data.step !=3){
							$(".timebar").countdown({
								image: "${basePath}images/activity/newyear2015/digits.png",
								format: "dd:hh:mm:ss",
								stop : data.remainTime == 0? 1:0,
								startTime: countDown(data.remainTime),
								timerEnd:function(){
									
								}
							});
							
							setTimeout(function(){
								location.reload(true);
								//location.href = "${basePath}/activity/newyear2015/package-index.html";
							}, data.remainTime);
						}
					}
				}
			};
			$.ajax(ajaxOptions);
			
			<s:if test="#request.userBook!=null">
// 				showTips("提示！", "您有一笔未完成的订单！", function(){
// 					location.href = '/activity/newyear2015/package-index.html';
// 				});
				var remainPayTime = parseInt("${remainPayTime}");
				if(remainPayTime >0){
					var sys_second = remainPayTime/1000;
					var minute = Math.floor((sys_second / 60) % 60);
					var second = Math.floor(sys_second % 60);
					confirmTips("提示", "您有一笔未完成的订单！</br><span id='remainTimeText' style='font-size:18px;color:red'>剩余支付时间："+minute+"分"+second+"秒</span>", doPay, cancelbuy,
					"付款",
					"取消订单");
					doRemainTimer(remainPayTime);
				}
			</s:if>
			
			function doRemainTimer(remainTime){
				var sys_second = (remainTime - 1000)/1000;	//减少一秒
				if(window["remainTimer"]){
					clearInterval(window["remainTimer"]);
				}
				window["remainTimer"] = setInterval(function(){
					var minute = Math.floor((sys_second / 60) % 60);
					var second = Math.floor(sys_second % 60);
					$("#remainTimeText").text("剩余支付时间："+minute+"分"+second+"秒");
					sys_second = sys_second - 1;
				}, 1000);
			}
			
		});
		
	</script>
</div>